<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

<style>

</style>

<div id="ci12pr-page" class="ci12pr-page">
  <section class="ci12prm-bg--black">
    <div class="ci12pr-container ci12pr-container--lg">
      <div class="ci12pr-title">Зустрічайте<br>iPhone 12 Pro</div>
      <div class="ci12pr-main-video">
        <video autoplay muted playsinline loop class="ci12pr-main-video__video lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/main.mp4">
        </video>
      </div>
    </div>
  </section>

  <section class="ci12prm-bg--black ci12pr-options">
    <div class="ci12pr-title">Система камер зі сканером PRO LiDAR</div>
    <div class="ci12prm-align--right">
      <div class="ci12pr-container ci12pr-container--restr-left">
        <div class="ci12pr-options__wr">
          <ul class="ci12pr-options__list js-options-list">
            <li class="ci12pr-options__item _active" data-option="telephoto">
              <a class="ci12pr-options__item-name js-camera-option">Телефото</a>
              <p class="ci12pr-options__item-desc">Щоб передати найбільш непомітні деталі та створити натуральні
                портрети</p>
            </li>
            <li class="ci12pr-options__item" data-option="ultra-wide-angle">
              <a class="ci12pr-options__item-name js-camera-option">Надширококутна</a>
              <p class="ci12pr-options__item-desc">Ідеальна для зйомки пейзажів та великих локацій. Передайте все, що
                знаходиться навколо</p>
            </li>
            <li class="ci12pr-options__item" data-option="wide-angle">
              <a class="ci12pr-options__item-name js-camera-option">Ширококутна</a>
              <p class="ci12pr-options__item-desc">Чудова якість нічних знімків, архітектури, інтер’єрних фото, навіть
                у тісних приміщеннях</p>
            </li>
            <li class="ci12pr-options__item" data-option="scanner">
              <a class="ci12pr-options__item-name js-camera-option">Сканер LiDAR</a>
              <p class="ci12pr-options__item-desc">Особливо природні живі портрети з натуральним ефектом боке</p>
            </li>
          </ul>
          <div class="ci12prm-hide-on--mobile">
            <img class="ci12pr-options__img js-camera-option-img _selected" data-option-name="telephoto" src="https://cdn.comfy.ua/media/x/img/iphone12-color/telephoto.png">
            <img class="ci12pr-options__img js-camera-option-img" data-option-name="ultra-wide-angle" src="https://cdn.comfy.ua/media/x/img/iphone12-color/ultra-wide-angle.png">
            <img class="ci12pr-options__img js-camera-option-img" data-option-name="wide-angle" src="https://cdn.comfy.ua/media/x/img/iphone12-color/wide-angle.png">
            <img class="ci12pr-options__img js-camera-option-img" data-option-name="scanner" src="https://cdn.comfy.ua/media/x/img/iphone12-color/scanner.png">
          </div>
        </div>
      </div>
    </div>
    <div class="ci12prm-show-on--mobile ci12pr-options__img-wr">
      <span class="ci12pr-options__img-indicator"></span>
      <span class="ci12pr-options__img-indicator"></span>
      <span class="ci12pr-options__img-indicator"></span>
      <span class="ci12pr-options__img-indicator"></span>
      <img class="ci12pr-options__img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/iphone-cameras-mob.png">
    </div>

  </section>

  <section class="ci12prm-bg--black ci12pr-display ci12prm-align--right">
    <div class="ci12pr-container ci12pr-container--restr-left">
      <div class="ci12pr-display__content">
        <div class="ci12pr-display__info">
          <div class="ci12pr-title">Збільшений дисплей<br>Super Retina XDR 6,1”</div>
          <p class="ci12pr-txt">
            Передня панель Ceramic Shield, з якою ризик пошкодження дисплея при падінні в 4 рази нижче
          </p>
        </div>
        <div class="ci12pr-display__img-wr">
          <video autoplay muted playsinline loop class="ci12pr-display__video lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/iphone12pro-displ.mp4">
          </video>
        </div>
      </div>
    </div>
  </section>

  <section class="ci12pr-camera ci12prm-bg">
    <div class="ci12pr-container ci12pr-container--lg ci12pr-camera__container">
      <div class="ci12pr-title">Досконалі можливості камери</div>
      <p class="ci12pr-txt">
        Знімайте і монтуйте HDR-відео 4K у стандарті Dolby Vision
      </p>
      <div class="ci12pr-camera__static-carousel ci12prm-show-on--mobile">
        <video autoplay muted playsinline loop class="ci12pr-camera__carousel lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/iphone12pro-slider-mob.mp4">
        </video>
      </div>
    </div>
    <div class="ci12prm-hide-on--mobile">
      <video autoplay muted playsinline loop class="ci12pr-camera__carousel lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/slider.mp4">
      </video>
    </div>
  </section>

  <section class="ci12prm-bg--black ci12pr-power">
    <div class="ci12pr-container">
      <header class="ci12pr-power__header">
        <div class="ci12pr-title">Раніше небачена потужність</div>
        <span class="ci12pr-txt">Процесор A14 Bionic</span>
      </header>
    </div>
    <div class="ci12pr-power__content">
      <video autoplay muted playsinline loop class="ci12pr-power__video lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/12pro-power.mp4">
      </video>
    </div>
  </section>

  <section class="ci12prm-bg--black ci12prm-bg--nigth-mode">
    <div class="ci12pr-container">
      <div class="ci12pr-night-mode">
        <div class="ci12pr-title">Нічний режим на всіх камерах</div>
        <div class="ci12pr-subtitle">ширококутній, надширококутній і камері TrueDepth</div>
        <p class="ci12pr-txt">
          Приголомшлива якість знімків при слабкому освітленні завдяки кращій системі камер Pro на iPhone. Оптичний
          зум з діапазоном 5x. Зйомка, монтаж і відтворення відео у кінематографічній якості в стандарті Dolby Vision.
          Нічний режим для портретів та доповнена реальність нового рівня завдяки сканеру LiDAR.
        </p>
      </div>
    </div>
    <div class="ci12pr-night-mode__img-wr">
      <img class="ci12pr-night-mode__img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/night-mode.png">
    </div>
  </section>

  <section class="ci12prm-bg ci12pr-accessories ci12prm-bg">
    <div class="ci12pr-container ci12pr-container--lg">
      <header class="ci12pr-accessories__header">
        <div class="ci12pr-accessories__header-content">
          <div class="ci12pr-title">Аксесуари MagSafe</div>
          <p class="ci12pr-txt">Це нова екосистема аксесуарів, які легко кріпляться та забезпечують більш швидку
            бездротову зарядку. Їх можна поєднувати один з одним і створювати комбінації в різних стилях.</p>
        </div>
        <span class="ci12pr-note">*Аксесуари продаються окремо</span>
      </header>
      <div class="ci12pr-accessories__content">
        <div class="ci12prm-show-on--mobile">
          <div class="ci12pr-title">Чохол-гаманець</div>
        </div>
        <div class="ci12pr-accessories__list">
          <div class="ci12pr-accessories__item">
            <div class="ci12pr-title ci12prm-hide-on--mobile">Чохол</div>
            <img class="ci12pr-accessories__item-img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/case.png">
          </div>
          <div class="ci12pr-accessories__item">
            <div class="ci12pr-title ci12prm-hide-on--mobile">Чохол-гаманець</div>
            <img class="ci12pr-accessories__item-img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/case-wallet.png">
          </div>
          <div class="ci12pr-accessories__item">
            <div class="ci12pr-title ci12prm-hide-on--mobile">Зарядний пристрій</div>
            <img class="ci12pr-accessories__item-img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/case-charge.png">
          </div>
        </div>
      </div>
      <footer class="ci12pr-accessories__footer">
        <p class="ci12pr-txt">
          Магніти забезпечують правильне сполучення пристроїв, тому бездротова зарядка стає швидше. Красиві чохли і
          чохли-гаманці легко і швидко примагнічуються та знімаються. iPhone розпізнає аксесуари MagSafe і миттєво
          з'єднується з ними.
        </p>
      </footer>
    </div>
  </section>

  <section class="ci12pr-video-capabilities">
    <div class="ci12pr-title">Вражаючі можливості відео</div>
    <video autoplay muted playsinline loop class="ci12pr-video-capabilities__video lazyload autoplay-video" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/video-capabilities.mp4">
    </video>

  </section>

  <section class="ci12pr-colors js-colors">
    <div class="ci12pr-container ci12pr-colors__content">
      <div class="ci12pr-colors__col">
        <div class="ci12pr-title">Ідеальні кольори</div>
        <div class="ci12pr-txt">4 ідеальних колірних рішення для нового iPhone 12 Pro</div>
        <ul class="ci12pr-colors__list">
          <li class="ci12pr-colors__list-item">
            <a class="ci12pr-colors__item ci12pr-colors__item--blue js-select-color _active" data-color="blue"></a>
          </li>
          <li class="ci12pr-colors__list-item">
            <a class="ci12pr-colors__item ci12pr-colors__item--gold js-select-color" data-color="gold"></a>
          </li>
          <li class="ci12pr-colors__list-item">
            <a class="ci12pr-colors__item ci12pr-colors__item--graphite js-select-color" data-color="graphite"></a>
          </li>
          <li class="ci12pr-colors__list-item">
            <a class="ci12pr-colors__item ci12pr-colors__item--silver js-select-color" data-color="silver"></a>
          </li>
        </ul>
      </div>
      <div class="ci12pr-colors__col">
        <img src="https://cdn.comfy.ua/media/x/img/iphone12-color/i12pro-graphite.png" data-phone-color="graphite" class="ci12pr-color-img js-color-img">
        <img src="https://cdn.comfy.ua/media/x/img/iphone12-color/i12pro-gold.png" data-phone-color="gold" class="ci12pr-color-img js-color-img">
        <img src="https://cdn.comfy.ua/media/x/img/iphone12-color/i12pro-silver.png" data-phone-color="silver" class="ci12pr-color-img js-color-img">
        <img src="https://cdn.comfy.ua/media/x/img/iphone12-color/i12pro-blue.png" data-phone-color="blue" class="ci12pr-color-img js-color-img _selected">
      </div>
      <ul class="ci12pr-colors__list">
        <li class="ci12pr-colors__list-item">
          <a class="ci12pr-colors__item ci12pr-colors__item--blue  js-select-color _active" data-color="blue"></a>
        </li>
        <li class="ci12pr-colors__list-item">
          <a class="ci12pr-colors__item ci12pr-colors__item--gold js-select-color" data-color="gold"></a>
        </li>
        <li class="ci12pr-colors__list-item">
          <a class="ci12pr-colors__item ci12pr-colors__item--graphite js-select-color" data-color="graphite"></a>
        </li>
        <li class="ci12pr-colors__list-item">
          <a class="ci12pr-colors__item ci12pr-colors__item--silver js-select-color" data-color="silver"></a>
        </li>
      </ul>
    </div>
  </section>

  <section class="ci12pr-set">
    <div class="ci12pr-container">
      <div class="ci12pr-title">Комплект поставки</div>
      <div class="ci12pr-set__content">
        <div class="ci12pr-set__item">
          <img class="ci12pr-set__img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/i12pro-set.png">
        </div>
        <span class="ci12pr-separator"></span>
        <div class="ci12pr-set__item">
          <img class="ci12pr-set__img lazyload" data-src="https://cdn.comfy.ua/media/x/img/iphone12-color/iphone12pro-set.png">
        </div>
      </div>
    </div>
  </section>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/scrollmagic@2.0.7/scrollmagic/uncompressed/ScrollMagic.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js"></script>


<script type="text/javascript">
  function scriptRequest(url, onSuccess, onError) {
    var script = document.createElement('script');

    script.onload = onSuccess
    script.onerror = onError
    script.src = url;

    document.body.appendChild(script);
  }
</script>

<script type="text/javascript">
  $(document).on('general-tab-open', () => {
    document.querySelectorAll('.autoplay-video').forEach((element) => {
      element.play();
    })
  })
  function init() {
    $('.js-colors').on('click', '.js-select-color', selectPhoneColor);
    $('.js-options-list').off('click').on('click', '.js-camera-option', setActiveCamera);
    $('.js-options-list').off('mouseover').on('mouseover', '.js-camera-option', setActiveCamera);
  }

  function selectPhoneColor(event) {
    if (!event || !event.target) {
      return;
    }
    var color = $(event.target).data('color');
    $('.js-select-color').removeClass('_active');
    $('.js-color-img').removeClass('_selected');
    $('.js-select-color[data-color=' + $(event.target).data('color') + ']').addClass("_active");
    $('.js-color-img[data-phone-color=' + $(event.target).data('color') + ']').addClass("_selected");
  }
  function setActiveCamera(event) {
    if ($(event.target).parent().hasClass('_active')) {
      return;
    }
    $('.js-camera-option').parent().removeClass('_active');
    $(event.target).parent().addClass('_active');
    $('.js-camera-option-img').removeClass('_selected');
    $('.js-camera-option-img[data-option-name=' + $(event.target).parent().data('option') + ']').addClass("_selected");
  }

  function initCarousel() {
    if ($('.slick-initialized').length) {
      return
    }

    $('.ci12pr-page__carousel-slider').slick({
      infinite: false,
      dots: true,
      lazyLoad: 'progressive',
      dotsClass: 'ci12pr-page__carousel-controls-dots',
      arrows: true,
      appendArrows: $('.ci12pr-page__carousel-controls'),
      appendDots: $('.ci12pr-page__carousel-dots'),
      prevArrow: `<div class="ci12pr-page__carousel-controls-button ci12pr-page__carousel-controls-prev">
                                      <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                          <path fill-rule="evenodd" clip-rule="evenodd" d="M15.7071 5.37883C16.0976 5.76935 16.0976 6.40252 15.7071 6.79304L10.4142 12.0859L15.7071 17.3788C16.0976 17.7694 16.0976 18.4025 15.7071 18.793C15.3166 19.1836 14.6834 19.1836 14.2929 18.793L8.29289 12.793C7.90237 12.4025 7.90237 11.7694 8.29289 11.3788L14.2929 5.37883C14.6834 4.98831 15.3166 4.98831 15.7071 5.37883Z" fill="#18AED1"/>
                                      </svg>
                                  </div>`,
      nextArrow: `<div class="ci12pr-page__carousel-controls-button ci12pr-page__carousel-controls-next">
                                      <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                          <path fill-rule="evenodd" clip-rule="evenodd" d="M8.29289 5.37883C8.68342 4.98831 9.31658 4.98831 9.70711 5.37883L15.7071 11.3788C16.0976 11.7694 16.0976 12.4025 15.7071 12.793L9.70711 18.793C9.31658 19.1836 8.68342 19.1836 8.29289 18.793C7.90237 18.4025 7.90237 17.7694 8.29289 17.3788L13.5858 12.0859L8.29289 6.79304C7.90237 6.40252 7.90237 5.76935 8.29289 5.37883Z" fill="#18AED1"/>
                                      </svg>
                                  </div>`,
      responsive: [
        {
          breakpoint: 767,
          settings: {
            appendArrows: '.ci12pr-page__carousel-slider',
          },
        },

      ],
    });
  }

  var vm = new Vue({
    el: '#ci12pr-page',
    data: {
      baseUrl: 'https://comfy.ua',
      sku: '1658929',
      productId: '1231063',
      cityId: window.currentCityId ? window.currentCityId.toString() : '506',
      cityName: '',
      storeId: document.location.href.includes('/ua/') ? '5' : '4',
      loading: false,
      prices: {
        price: 0,
        oldPrice: 0,
        discountPercent: 0,
        discountValue: 0
      },
      reviews: {
        count: 0,
        ratingPercent: 0,
      },
      product: {
        attributeGroups: [],
        breadcrumbs: [],
        images: [],
        urlKey: ''
      },
      labels: {
        items: []
      },
      showAllReviews: false,
      citiesSuggestions: [],
      selectedCity: {
        name: '',
        id: ''
      },
      remains: {
        isPreorder: false,
        isAvailable: false,
        isRetail: false,
        hasNoRemains: false
      },
      fromCityName: '',
      formCityId: '',
      popupRequestSended: false,
      reviewsItems: [],
      selectedAccessoriesGroupId: 0,
      showAllAccessoriesGroups: false,
      showAllAccessories: false,
      accessoriesGroups: [],
      accessories: {
        items: []
      },
      warehouses: {
        items: []
      }
    },
    watch: {
      fromCityName: function (val) {
        if (this.fromCityName != this.selectedCity.name) {
          this.selectedCity.name = '';
          this.selectedCity.id = '';
          $('.ci12pr-page__popup-form-input-city-id').val('')
          this.fetchCitiesList()
        }
      },
    },
    mounted() {
      this.loading = true

      Promise.all([
        this.fetchPrices(),
        this.fetchReviews(),
        this.fetchProduct(),
        this.fetchLabels(),
        this.fetchCityName(),
        this.fetchRemains(),
        this.fetchReviewsItems(),
        this.fetchAccessoriesGroups(),
        this.fetchWarehouses()
      ])
        .finally(() => {
          this.loading = false
        })

      $(document).ready(() => {
        setTimeout(this.init, 1000);
        setTimeout(this.initCarousel, 1000);
        setTimeout(this.initCustomHeader, 200)
      });

      this.initScrollMagic();

      this.initEquipmentHandler();

      this.initPopup();
    },
    methods: {
      onAvailabilityScroll() {
        let element = document.querySelector('.ci12pr-page__warehouses');

        if (element) {
          element.scrollIntoView({ block: "center", behavior: "smooth" });
        }
      },
      fetchWarehouses() {
        this.accessories.items = [];
        return fetch(this.baseUrl + '/api/remains/warehouses?sku=' + this.sku + '&storeId=' + this.storeId + '&cityId=' + this.cityId)
          .then(resp => resp.json())
          .then(resp => this.warehouses.items.splice(0, this.warehouses.items.length, ...resp.items))
      },
      init() {
        init()
      },
      initCarousel() {
        if (typeof $('.ci12pr-page__carousel-slider').slick != 'function') {
          scriptRequest('https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js',
            function () {
              initCarousel()
            },
            function (err) {
              console.error(err)
            }
          )
        } else {
          initCarousel()
        }
      },
      initCustomHeader() {
        if (!document.querySelector('.main')) {
          return;
        }
        let height = document.querySelector('.main').offsetHeight + document.querySelector('.header-top').offsetHeight + document.querySelector('.header-bottom').offsetHeight

        $('.rowenta-banner-wr').appendTo('.header-bottom').hide();

        if (window.screen.width > 768) {
          $(document).scroll(function () {
            let y = $(this).scrollTop();
            if (y > height) {
              $('.header-bottom .rowenta-banner-wr').fadeIn();
            } else {
              $('.header-bottom .rowenta-banner-wr').fadeOut();
            }
          });
        }
      },
      initPopup() {
        $('#ci12pr-page__preorder-popup .ci12pr-page__popup-form-input-phone').mask('+38 - (000) - 000 - 00 - 00');
        $('#ci12pr-page__sms-popup .ci12pr-page__popup-form-input-phone').mask('+38 - (000) - 000 - 00 - 00');
        $('body').append($('#ci12pr-page__sms-popup'));
        $('body').append($('#ci12pr-page__sms-popup'));

        $('#ci12pr-page__preorder-popup form').validate({
          rules: {
            name: {
              required: true
            },
            phone: {
              required: true,
              minlength: 27
            },
            city_name: {
              required: true

            },
            city_id: {
              required: true
            }
          },
          messages: {
            name: `Обов'язкове поле`,
            phone: 'Номер телефону повинен складатися з 12 цифр',
            city_id: `Обов'язкове поле`
          },
          submitHandler: (form, event) => {
            event.preventDefault();

            this.sendPreorderRequest();
          }
        });

        $('#ci12pr-page__sms-popup form').validate({
          rules: {
            name: {
              required: true
            },
            phone: {
              required: true,
              minlength: 27,
            },
          },
          messages: {
            name: `Обов'язкове поле`,
            phone: 'Номер телефону повинен складатися з 12 цифр',
          },
          submitHandler: (form, event) => {
            event.preventDefault();

            this.sendSmsRequest();
          }
        });

        $('body').click((ev) => {
          if ($('body').hasClass('_overlay-region-stock') && !$(ev.target).parents('.ci12pr-page__popup').length && !$(ev.target).hasClass('')) {
            this.hidePreorderPopup();
            this.hideSmsPopup();
          }
        })
      },
      initScrollMagic() {
        $('.ci12pr-page__promo-video-item').on('loadedmetadata', function () {
          let video = document.querySelector(".ci12pr-page__promo-video-item");

          if (this.iOS()) {
            let videoHack = $('.ci12pr-page__promo-video-wr-hack')

            videoHack.attr('src', 'https://cdn.comfy.ua/media/x/img/iphone12-color/rowenta-video-hack.jpg');
          }

          video.pause();
          video.currentTime = 0;

          let rate = 300
          let interval = 33;
          let accelamount = 0.5; // new
          let rateDuration = video.duration * rate
          let currentRateDuration = video.currentTime * rate
          let totalDuration = rateDuration - currentRateDuration

          let oldTime = currentRateDuration / rate
          let newTime = currentRateDuration / rate

          let controller = new ScrollMagic.Controller();

          let scene = new ScrollMagic.Scene({
            triggerElement: ".ci12pr-page__promo-video-wr",
            duration: totalDuration
          })
            .addTo(controller)
            .on("update", function (e) {
              oldTime = (e.scrollPos + currentRateDuration) / rate
            });

          let requestFrameId = 0

          let go = () => {
            newTime += (oldTime - newTime) * accelamount; //new
            video.currentTime = newTime

            requestFrameId = 0
          }

          setInterval(() => {
            if (!requestFrameId) {
              requestFrameId = requestAnimationFrame(go)
            }
          }, interval)
        }.bind(this))
      },
      iOS() {
        return [
          'iPad Simulator',
          'iPhone Simulator',
          'iPod Simulator',
          'iPad',
          'iPhone',
          'iPod'
        ].includes(navigator.platform)
          // iPad on iOS 13 detection
          || (navigator.userAgent.includes("Mac"))
      },
      fetchPrices() {
        return fetch(this.baseUrl + '/api/prices/expanded?product_id=' + this.productId + '&sku=' + this.sku + '&city_id=' + this.cityId)
          .then(resp => resp.json())
          .then(resp => {
            this.prices.price = resp.specialPrice
            this.prices.oldPrice = resp.price
            this.prices.discountPercent = Math.round(100 - this.prices.price / this.prices.oldPrice * 100)
            this.prices.discountValue = this.prices.oldPrice - this.prices.price
          })
          .catch((e) => this.loading = false)
      },
      fetchReviews() {
        return fetch(this.baseUrl + '/api/reviews/' + this.productId + '/' + this.storeId + '/summary')
          .then(resp => resp.json())
          .then(resp => {
            this.reviews.count = resp.count
            this.reviews.ratingPercent = +(resp.rating.avg / 5 * 100).toFixed(0)
          })
          .catch((e) => this.loading = false)
      },
      fetchProduct() {
        return fetch(this.baseUrl + '​/api/products/single/' + this.sku + '?storeId=' + this.storeId)
          .then(resp => resp.json())
          .then(resp => {
            this.product.attributeGroups.splice(0, this.product.attributeGroups.length, ...resp.attributeGroups);
            this.product.breadcrumbs.splice(0, this.product.breadcrumbs.length, ...resp.breadcrumbs);
            this.product.images.splice(0, this.product.images.length, ...resp.images);
            this.product.urlKey = resp.urlKey;
          })
      },
      fetchLabels() {
        return fetch(this.baseUrl + '/api/labels/list?productId=' + this.productId + '&sku=' + this.sku + '&storeId=' + this.storeId + '&cityId=' + this.cityId + '&useFor=1')
          .then(resp => resp.json())
          .then(resp => this.labels = resp)
      },
      fetchCityName() {
        return fetch(this.baseUrl + '/api/cities/single/' + this.cityId + '/' + this.storeId)
          .then(resp => resp.json())
          .then(resp => this.cityName = resp.name)
      },
      onPreviewPhotoClick(index) {
        let caruosel = $('.ci12pr-page__carousel-slider');

        if (typeof caruosel.slick != 'function') {
          return
        } else {
          caruosel.slick('slickGoTo', index);
        }
      },

      initEquipmentHandler() {
        $('.ci12pr-page-equipment:not(.ci12pr-page-equipment-mobile) .ci12pr-page__list-item').hover(this.equipmentListHandler);
      },

      equipmentListHandler(event) {
        let target = $(event.currentTarget);
        target.parent().toggleClass('ci12pr-page__list_focused');
        target.toggleClass('ci12pr-page__list-item_focused');
      },
      fetchCitiesList() {
        return fetch(this.baseUrl + '/api/cities/all?q=' + this.fromCityName + '&limit=4&lang=' + this.storeId)
          .then(resp => resp.json())
          .then(resp => this.citiesSuggestions.splice(0, this.citiesSuggestions.length, ...resp))
      },
      fetchReviewsItems() {
        return fetch(this.baseUrl + '/api/reviews/' + this.productId + '/' + this.storeId)
          .then(resp => resp.json())
          .then(resp => this.reviewsItems.splice(0, this.reviewsItems.length, ...resp.reviews))
      },
      fetchRemains() {
        return fetch(this.baseUrl + '/api/remains/amp/' + this.sku + '?storeId=' + this.storeId + '&cityId=' + this.cityId)
          .then(resp => resp.json())
          .then(resp => {
            this.remains.isPreorder = resp.flags.isPreorder;
            this.remains.isAvailable = resp.flags.isAvailable;
            this.remains.isRetail = resp.flags.isRetail;
            this.remains.hasNoRemains = resp.flags.hasNoRemains
          })
      },
      declOfNum(number, words) {
        return words[(number % 100 > 4 && number % 100 < 20) ? 2 : [2, 0, 1, 1, 1, 2][(number % 10 < 5) ? number % 10 : 5]];
      },
      onCitySelect(name, id) {
        this.selectedCity.name = name;
        this.selectedCity.id = id;
        $('.ci12pr-page__popup-form-input-city-id').val(id);
        $('#city_id-error').hide()
        this.fromCityName = name;
        this.formCityId = id;
      },
      onToggleReviews() {
        this.showAllReviews = !this.showAllReviews;
      },
      onReviewsScroll() {
        let element = document.querySelector('.ci12pr-page__reviews-block');

        if (element) {
          element.scrollIntoView({ block: "center", behavior: "smooth" });
        }
      },
      onAuthClick() {
        $('#headerProfileBlock .js-header-login-link').click()
      },
      openPreorderPopup() {
        $('body').addClass('_overlay-region-stock');
        $('#ci12pr-page__preorder-popup').show();
      },
      hidePreorderPopup() {
        $('body').removeClass('_overlay-region-stock');
        $('#ci12pr-page__preorder-popup').hide();
      },
      openSmsPopup() {
        if (window.userInfo == undefined) {
          $('#ci12pr-page__sms-popup').find('.ci12pr-page__popup-auth-notification').show();
          $('#ci12pr-page__sms-popup').find('.ci12pr-page__popup-form').hide();
        } else {
          $('#ci12pr-page__sms-popup').find('.ci12pr-page__popup-auth-notification').hide();
          $('#ci12pr-page__sms-popup').find('.ci12pr-page__popup-form').show();
        }

        $('body').addClass('_overlay-region-stock');
        $('#ci12pr-page__sms-popup').show();
      },
      hideSmsPopup() {
        $('body').removeClass('_overlay-region-stock');
        $('#ci12pr-page__sms-popup').hide();
      },
      sendPreorderRequest() {
        $('#ci12pr-page__preorder-popup .ci12pr-page__popup-footer-btn').addClass('ci12pr-page__popup-footer-btn_loading');

        $form = $('#ci12pr-page__preorder-popup .ci12pr-page__popup-form')

        $.ajax({
          url: `${this.baseUrl}/preorder/preorder/create`,
          type: 'post',
          data: $form.serialize(),

          success: $.proxy(function (res) {
            if (res.status == 'success') {
              this.popupRequestSended = true
            }

            $('#ci12pr-page__preorder-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),

          error: $.proxy(function (res) {
            $('#ci12pr-page__preorder-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),

          always: $.proxy(function () {
            $('#ci12pr-page__preorder-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),
        })
      },
      sendSmsRequest() {
        $('#ci12pr-page__sms-popup .ci12pr-page__popup-footer-btn').addClass('ci12pr-page__popup-footer-btn_loading');

        $form = $('#ci12pr-page__sms-popup .ci12pr-page__popup-form')

        $.ajax({
          url: `${this.baseUrl}/stockalert/stockalert/sms`,
          type: 'post',
          data: $form.serialize(),

          success: $.proxy(function (res) {
            $('#ci12pr-page__sms-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')

            if (res.status == 'success') {
              this.popupRequestSended = true
            }

            $('#ci12pr-page__sms-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),

          error: $.proxy(function (res) {
            $('#ci12pr-page__sms-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),

          always: $.proxy(function () {
            $('#ci12pr-page__sms-popup .ci12pr-page__popup-footer-btn').removeClass('ci12pr-page__popup-footer-btn_loading')
          }, this),
        })
      },
      onToggleAccessoriesGroups() {
        this.showAllAccessoriesGroups = !this.showAllAccessoriesGroups;
      },
      onToggleAccessories() {
        this.showAllAccessories = !this.showAllAccessories;
      },
      onChangeAccessoriesGroup(groupId) {
        this.selectedAccessoriesGroupId = groupId;
        this.fetchAccessories();
      },
      fetchAccessoriesGroups() {
        return fetch(this.baseUrl + '/api/accessories/groups?sku=' + this.sku + '&cityId=' + this.cityId + '&storeId=' + this.storeId)
          .then(resp => resp.json())
          .then(resp => this.accessoriesGroups.splice(0, this.accessoriesGroups.length, ...resp))
          .then(() => this.selectedAccessoriesGroupId = this.accessoriesGroups[0].id)
          .then(() => this.fetchAccessories());
      },
      fetchAccessories() {
        this.accessories.items = [];
        return fetch(this.baseUrl + '/api/accessories/group/' + this.selectedAccessoriesGroupId + '/list?cityId=' + this.cityId + '&sku=' + this.sku + '&storeId=' + this.storeId)
          .then(resp => resp.json())
          .then(resp => this.accessories = resp)
      },
      sendAvailabilityRequest(event, id) {
        $(event.target).addClass('availability-btn-loading');

        return fetch(this.baseUrl + '/checkout/cart/add/product/' + this.productId + '/shipping_method/carry_carry/warehouse/' + id + '/ajax/1')
          .then(() => document.location.reload())
          .catch(() => $(event.target).removeClass('availability-btn-loading'))
      }
    }
  })
</script>